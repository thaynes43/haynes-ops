---
description:
globs:
alwaysApply: true
---

# Introduction

This repository manages kubernetes clusters that run on Talos Linux by Sidero Labs whos documentation may be found [here](https://www.talos.dev/v1.10/introduction/). The Talos Linux kubernetes nodes are managed by Sidero Lab's Omni software who's documentation may be found [here](https://docs.siderolabs.com/omni/overview/what-is-omni). The use of the utility Talosctl is limited as the utility Omnictl handles cluster management.

This repository follows patterns put into place by a group of kubernetes home lab enthusiests who meet in the `Home Operations` discord. They use to manage popular helm charts known as `k8s at home` but those have been deprecated. Instead of individual charts most services may be hosted using [bjw-s-labs app template](https://bjw-s-labs.github.io/helm-charts/docs/app-template/)

Excellent examples of `home-ops` repositories would be [onedr0p's](https://github.com/onedr0p/home-ops) and [bjw-s-labs'](https://github.com/bjw-s-labs/home-ops). Note these are single cluster repositorys. A multi cluster example would be [szinn's](https://github.com/szinn/k8s-homelab)

## Repo Structure

This repository currently has apps for two seperate kubernetes clusters. They are `main` and `edge`. The `main` cluster is currently running in a server rack at the users home. The `edge` cluster will be used to test some re-architecting of the repository before it is applied to the production cluster `main`.

haynes-ops/
â””â”€â”€ kubernetes/                    # GitOps Root
    â”œâ”€â”€ main/                      # ğŸ  Primary Cluster
    â”‚   â”œâ”€â”€ apps/                  # Application Deployments
    â”‚   â”‚   â”œâ”€â”€ ...
    â”‚   â”œâ”€â”€ bootstrap/           # Cluster Bootstrap
    â”‚   â”‚   â”œâ”€â”€ ...
    â”‚   â””â”€â”€ flux/               # Flux Configuration
    â”‚       â”œâ”€â”€ ...
    â”‚
    â”œâ”€â”€ edge/                   # ğŸŒ Edge Cluster
    â”‚   â”œâ”€â”€ apps/              # Edge Applications
    â”‚   â”‚   â””â”€â”€ flux-system/   # Edge Flux Add-ons
    â”‚   â”œâ”€â”€ bootstrap/         # Edge Bootstrap
    â”‚   â””â”€â”€ flux/             # Edge Flux Config
    â”‚       â”œâ”€â”€ ...
    â”‚
    â””â”€â”€ shared/                # ğŸ”„ Cross-Cluster Resources
        â”œâ”€â”€ components/        # Reusable Kustomize Components
        â”‚   â””â”€â”€ common/
        â”‚       â”œâ”€â”€ ...
        â””â”€â”€ templates/         # Reusable Templates
            â”œâ”€â”€ ...

# Instructions

- **GitOps Strictly**: This repository is the source of truth. All changes to the cluster MUST be made via Git commits to this repository. Flux will then apply them.
- **No Manual `kubectl apply`**: Do not manually apply manifests to the cluster. `kubectl` is permitted for read-only operations (get, describe, logs) or temporary debugging only.
- **Repopulation Capability**: This repository must remain capable of bootstrapping a cluster from scratch (or "nuke"). Avoid any state or configuration that exists only on the cluster and not in Git.
- **Do not run kubectl**: This VSCode environment is not set up to reach the cluster. Tell the user to run the commands and send back the output instead.
- **Do not run talosctl/omnictl**: Same as above.
